<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
  <title>
syntax.ml, unify.ml, solve.ml, lexer.mll, parser.mly, message.ml, miniprolog.ml</title>
  <meta name="GENERATOR" content="caml2html 1.3.0">
<style type="text/css">
code,pre { color:black;background-color:white }a.Cannot { color:black;text-decoration:none }.Cannot:hover { background-color: #b4eeb4; }
.Cbar,
.Cdo,
.Cdone,
.Cdownto,
.Celse,
.Cfor,
.Cif,
.Clazy,
.Cmatch,
.Cnew,
.Cor,
.Cthen,
.Cto,
.Ctry,
.Cwhen,
.Cwhile,
.Cwith { color: #77aaaa; }
.Cassert,
.Cinclude,
.Copen { color: #cc9900; }
.Cstring { color: #aa4444; }
.Cand,
.Cas,
.Cclass,
.Cconstraint,
.Cexception,
.Cexternal,
.Cfun,
.Cfunction,
.Cfunctor,
.Cin,
.Cinherit,
.Cinitializer,
.Clet,
.Cmethod,
.Cmodule,
.Cmutable,
.Cof,
.Cprivate,
.Crec,
.Ctype,
.Cval,
.Cvirtual { color: green; }
.Cbackground { background-color: white; }
.Craise { color: red; }
.Cconstructor { color: #0033cc; }
.Ccomment { color: #990000; }
.Calphakeyword,
.Casr,
.Cland,
.Clor,
.Clsl,
.Clsr,
.Clxor,
.Cmod { color: #808080; }
.Clinenum { color: black; background-color: silver; }
.Cbegin,
.Cend,
.Cobject,
.Csig,
.Cstruct { color: #990099; }
.Cfalse,
.Cnonalphakeyword,
.Cquotation,
.Ctrue { }
</style>
</head>
<body>

Taken from Andrej Bauer's PL Zoo, specifically andrej.com/plzoo/html/miniprolog.html
My understanding is the source code is released under the BSD open source license.

<h1><a name="syntax.ml"></a><code>syntax.ml</code></h1>

<pre><span class="Clinenum">   1:</span><span class="Cbackground"> </span><span class="Ccomment">(** Abstract syntax. *)</span>
<span class="Clinenum">   2:</span><span class="Cbackground"> </span>
<span class="Clinenum">   3:</span><span class="Cbackground"> </span><span class="Ccomment">(** Constants and atoms are strings starting with lower-case letters. *)</span>
<span class="Clinenum">   4:</span><span class="Cbackground"> </span><span class="Ctype">type</span> constant <span class="Cnonalphakeyword">=</span> string
<span class="Clinenum">   5:</span><span class="Cbackground"> </span>    
<span class="Clinenum">   6:</span><span class="Cbackground"> </span><span class="Ccomment">(** Variables are strings starting with upper-case letters, followed</span>
<span class="Clinenum">   7:</span><span class="Cbackground"> </span><span class="Ccomment">    by a number which indicates an instance of the variable. Thus a</span>
<span class="Clinenum">   8:</span><span class="Cbackground"> </span><span class="Ccomment">    variable instance is a pair [(x,n)] where [x] is a variable and [n] is</span>
<span class="Clinenum">   9:</span><span class="Cbackground"> </span><span class="Ccomment">    an integer. When the proof search depth is [n] all variables that we</span>
<span class="Clinenum">  10:</span><span class="Cbackground"> </span><span class="Ccomment">    need to use are renamed from [(x,0)] to [(x,n)]. This is necessary so</span>
<span class="Clinenum">  11:</span><span class="Cbackground"> </span><span class="Ccomment">    that we do not use the same variable name in two different</span>
<span class="Clinenum">  12:</span><span class="Cbackground"> </span><span class="Ccomment">    applications of the same assertion. *)</span>
<span class="Clinenum">  13:</span><span class="Cbackground"> </span><span class="Ctype">type</span> variable <span class="Cnonalphakeyword">=</span> string <span class="Cnonalphakeyword">*</span> int
<span class="Clinenum">  14:</span><span class="Cbackground"> </span>
<span class="Clinenum">  15:</span><span class="Cbackground"> </span><span class="Ccomment">(** The datatype of terms. *)</span>
<span class="Clinenum">  16:</span><span class="Cbackground"> </span><span class="Ctype">type</span> term <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  17:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Var</span> <span class="Cof">of</span> variable             <span class="Ccomment">(** Variable [X1], [Y0], [Z2], ... *)</span>
<span class="Clinenum">  18:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Const</span> <span class="Cof">of</span> constant           <span class="Ccomment">(** Constant [a], [b], [c], ... *)</span>
<span class="Clinenum">  19:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">App</span> <span class="Cof">of</span> constant <span class="Cnonalphakeyword">*</span> term list <span class="Ccomment">(** Compound term [f(t_1,...,t_n)] *)</span>
<span class="Clinenum">  20:</span><span class="Cbackground"> </span>
<span class="Clinenum">  21:</span><span class="Cbackground"> </span><span class="Ccomment">(** Atomic proposition [p(t_1, ..., t_n)] *)</span>
<span class="Clinenum">  22:</span><span class="Cbackground"> </span><span class="Ctype">type</span> atom <span class="Cnonalphakeyword">=</span> constant <span class="Cnonalphakeyword">*</span> term list
<span class="Clinenum">  23:</span><span class="Cbackground"> </span>
<span class="Clinenum">  24:</span><span class="Cbackground"> </span><span class="Ccomment">(** A conjunction of atomic propositions [p_1, ..., p_n]. The empty</span>
<span class="Clinenum">  25:</span><span class="Cbackground"> </span><span class="Ccomment">    list represents [true]. *)</span>
<span class="Clinenum">  26:</span><span class="Cbackground"> </span><span class="Ctype">type</span> clause <span class="Cnonalphakeyword">=</span> atom list
<span class="Clinenum">  27:</span><span class="Cbackground"> </span>
<span class="Clinenum">  28:</span><span class="Cbackground"> </span><span class="Ccomment">(** An assertion [(a,b_1,...,b_n)] is a Horn formula [b_1 &amp; ... &amp; b_n =&gt; a]. *)</span>
<span class="Clinenum">  29:</span><span class="Cbackground"> </span><span class="Ctype">type</span> assertion <span class="Cnonalphakeyword">=</span> atom <span class="Cnonalphakeyword">*</span> clause
<span class="Clinenum">  30:</span><span class="Cbackground"> </span>
<span class="Clinenum">  31:</span><span class="Cbackground"> </span><span class="Ccomment">(** An environment is a list of pairs [(x, e)] where [x] is a variable</span>
<span class="Clinenum">  32:</span><span class="Cbackground"> </span><span class="Ccomment">    instance and [e] is a term. An environment represents the current</span>
<span class="Clinenum">  33:</span><span class="Cbackground"> </span><span class="Ccomment">    values of variables. *)</span>
<span class="Clinenum">  34:</span><span class="Cbackground"> </span><span class="Ctype">type</span> environment <span class="Cnonalphakeyword">=</span> <span class="Cnonalphakeyword">(</span>variable <span class="Cnonalphakeyword">*</span> term<span class="Cnonalphakeyword">)</span> list
<span class="Clinenum">  35:</span><span class="Cbackground"> </span>
<span class="Clinenum">  36:</span><span class="Cbackground"> </span><span class="Ccomment">(** A database is a list of assertions. It represents the current</span>
<span class="Clinenum">  37:</span><span class="Cbackground"> </span><span class="Ccomment">    program. *)</span>
<span class="Clinenum">  38:</span><span class="Cbackground"> </span><span class="Ctype">type</span> database <span class="Cnonalphakeyword">=</span> assertion list
<span class="Clinenum">  39:</span><span class="Cbackground"> </span>
<span class="Clinenum">  40:</span><span class="Cbackground"> </span><span class="Ccomment">(** Toplevel commands. *)</span>    
<span class="Clinenum">  41:</span><span class="Cbackground"> </span><span class="Ctype">type</span> toplevel_cmd <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  42:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Assert</span> <span class="Cof">of</span> assertion  <span class="Ccomment">(** Assertion [a :- b_1, ..., b_n.] or [a.] *)</span>
<span class="Clinenum">  43:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Goal</span> <span class="Cof">of</span> clause       <span class="Ccomment">(** Query [?- a] *)</span>
<span class="Clinenum">  44:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Quit</span>                 <span class="Ccomment">(** The [$quit] command. *)</span>
<span class="Clinenum">  45:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Use</span> <span class="Cof">of</span> string        <span class="Ccomment">(** The [$use "filename"] command. *)</span>
<span class="Clinenum">  46:</span><span class="Cbackground"> </span>      
<span class="Clinenum">  47:</span><span class="Cbackground"> </span><span class="Ccomment">(** [lookup env x] returns the value of variable instance [x] in</span>
<span class="Clinenum">  48:</span><span class="Cbackground"> </span><span class="Ccomment">    environment [env]. It returns [Var x] if the variable does not occur</span>
<span class="Clinenum">  49:</span><span class="Cbackground"> </span><span class="Ccomment">    in [env]. *)</span>
<span class="Clinenum">  50:</span><span class="Cbackground"> </span><span class="Clet">let</span> <span class="Crec">rec</span> lookup env x <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  51:</span><span class="Cbackground"> </span>  <span class="Ctry">try</span> <span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>assoc x env <span class="Cwith">with</span> <span class="Cconstructor">Not_found</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">Var</span> x
<span class="Clinenum">  52:</span><span class="Cbackground"> </span>
<span class="Clinenum">  53:</span><span class="Cbackground"> </span>
<span class="Clinenum">  54:</span><span class="Cbackground"> </span><span class="Ccomment">(** [subst_term sub t] substitutes in term [t] values for variables,</span>
<span class="Clinenum">  55:</span><span class="Cbackground"> </span><span class="Ccomment">    as specified by the associative list [s]. It substitutes</span>
<span class="Clinenum">  56:</span><span class="Cbackground"> </span><span class="Ccomment">    repeatedly until the terms stops changing, so this is not the</span>
<span class="Clinenum">  57:</span><span class="Cbackground"> </span><span class="Ccomment">    usual kind of substitution. It is what we need during</span>
<span class="Clinenum">  58:</span><span class="Cbackground"> </span><span class="Ccomment">    unification. *)</span>
<span class="Clinenum">  59:</span><span class="Cbackground"> </span><span class="Clet">let</span> <span class="Crec">rec</span> subst_term env <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
<span class="Clinenum">  60:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Var</span> x <span class="Cas">as</span> e <span class="Cnonalphakeyword">-&gt;</span>
<span class="Clinenum">  61:</span><span class="Cbackground"> </span>      <span class="Cnonalphakeyword">(</span><span class="Clet">let</span> e' <span class="Cnonalphakeyword">=</span> lookup env x <span class="Cin">in</span>
<span class="Clinenum">  62:</span><span class="Cbackground"> </span>         <span class="Cif">if</span> e <span class="Cnonalphakeyword">=</span> e' <span class="Cthen">then</span> e' <span class="Celse">else</span> subst_term env e'<span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  63:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Const</span> <span class="Cnonalphakeyword">_</span> <span class="Cas">as</span> e <span class="Cnonalphakeyword">-&gt;</span> e
<span class="Clinenum">  64:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">App</span> <span class="Cnonalphakeyword">(</span>c<span class="Cnonalphakeyword">,</span> ls<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">App</span> <span class="Cnonalphakeyword">(</span>c<span class="Cnonalphakeyword">,</span> <span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>map <span class="Cnonalphakeyword">(</span>subst_term env<span class="Cnonalphakeyword">)</span> ls<span class="Cnonalphakeyword">)</span>        
<span class="Clinenum">  65:</span><span class="Cbackground"> </span>
<span class="Clinenum">  66:</span><span class="Cbackground"> </span>
<span class="Clinenum">  67:</span><span class="Cbackground"> </span><span class="Ccomment">(** [string_of_term t] converts term [t] to its string represenation. *)</span>
<span class="Clinenum">  68:</span><span class="Cbackground"> </span><span class="Clet">let</span> <span class="Crec">rec</span> string_of_term <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
<span class="Clinenum">  69:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Var</span> <span class="Cnonalphakeyword">(</span>v<span class="Cnonalphakeyword">,</span> 0<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> v
<span class="Clinenum">  70:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Var</span> <span class="Cnonalphakeyword">(</span>v<span class="Cnonalphakeyword">,</span> n<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> v ^ string_of_int n
<span class="Clinenum">  71:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Const</span> c <span class="Cnonalphakeyword">-&gt;</span> c
<span class="Clinenum">  72:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">App</span> <span class="Cnonalphakeyword">(</span>f<span class="Cnonalphakeyword">,</span> ls<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> f ^ <span class="Cstring">"("</span> ^ <span class="Cnonalphakeyword">(</span><span class="Cconstructor">String</span><span class="Cnonalphakeyword">.</span>concat <span class="Cstring">", "</span> <span class="Cnonalphakeyword">(</span><span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>map string_of_term ls<span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">)</span> ^ <span class="Cstring">")"</span>
<span class="Clinenum">  73:</span><span class="Cbackground"> </span>
<span class="Clinenum">  74:</span><span class="Cbackground"> </span><span class="Ccomment">(** [string_of_env env] converts environment [env] to its string</span>
<span class="Clinenum">  75:</span><span class="Cbackground"> </span><span class="Ccomment">    representation. It only keeps instance variables at level 0, i.e.,</span>
<span class="Clinenum">  76:</span><span class="Cbackground"> </span><span class="Ccomment">    those that appear in the toplevel goal. *)</span>
<span class="Clinenum">  77:</span><span class="Cbackground"> </span><span class="Clet">let</span> string_of_env env <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  78:</span><span class="Cbackground"> </span>  <span class="Cmatch">match</span> <span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>filter <span class="Cnonalphakeyword">(</span><span class="Cfun">fun</span> <span class="Cnonalphakeyword">(</span><span class="Cnonalphakeyword">(</span><span class="Cnonalphakeyword">_</span><span class="Cnonalphakeyword">,</span> n<span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">,</span> <span class="Cnonalphakeyword">_</span><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> n <span class="Cnonalphakeyword">=</span> 0<span class="Cnonalphakeyword">)</span> env <span class="Cwith">with</span>
<span class="Clinenum">  79:</span><span class="Cbackground"> </span>    <span class="Cbar">|</span> <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cstring">"Yes"</span>
<span class="Clinenum">  80:</span><span class="Cbackground"> </span>    <span class="Cbar">|</span> env' <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">String</span><span class="Cnonalphakeyword">.</span>concat <span class="Cstring">"\n"</span>
<span class="Clinenum">  81:</span><span class="Cbackground"> </span>        <span class="Cnonalphakeyword">(</span><span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>map
<span class="Clinenum">  82:</span><span class="Cbackground"> </span>           <span class="Cnonalphakeyword">(</span><span class="Cfun">fun</span> <span class="Cnonalphakeyword">(</span><span class="Cnonalphakeyword">(</span>x<span class="Cnonalphakeyword">,</span>n<span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">,</span> e<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span>
<span class="Clinenum">  83:</span><span class="Cbackground"> </span>              x ^ <span class="Cstring">" = "</span> ^ string_of_term <span class="Cnonalphakeyword">(</span>subst_term env e<span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  84:</span><span class="Cbackground"> </span>           <span class="Cnonalphakeyword">(</span><span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>rev env'<span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  85:</span><span class="Cbackground"> </span>
<span class="Clinenum">  86:</span><span class="Cbackground"> </span><span class="Ccomment">(** [occurs x t] returns [true] when variable instance [x] appears in</span>
<span class="Clinenum">  87:</span><span class="Cbackground"> </span><span class="Ccomment">    term [t]. *)</span>
<span class="Clinenum">  88:</span><span class="Cbackground"> </span><span class="Clet">let</span> <span class="Crec">rec</span> occurs x <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
<span class="Clinenum">  89:</span><span class="Cbackground"> </span>    <span class="Cconstructor">Var</span> y <span class="Cnonalphakeyword">-&gt;</span> x <span class="Cnonalphakeyword">=</span> y
<span class="Clinenum">  90:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Const</span> <span class="Cnonalphakeyword">_</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cfalse">false</span>
<span class="Clinenum">  91:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">App</span> <span class="Cnonalphakeyword">(</span><span class="Cnonalphakeyword">_</span><span class="Cnonalphakeyword">,</span> ts<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>exists <span class="Cnonalphakeyword">(</span>occurs x<span class="Cnonalphakeyword">)</span> ts
</pre>

<hr>
<h1><a name="unify.ml"></a><code>unify.ml</code></h1>

<pre><span class="Clinenum">   1:</span><span class="Cbackground"> </span><span class="Ccomment">(** Unification functions. *)</span>
<span class="Clinenum">   2:</span><span class="Cbackground"> </span>
<span class="Clinenum">   3:</span><span class="Cbackground"> </span><span class="Copen">open</span> <span class="Cconstructor">Syntax</span>
<span class="Clinenum">   4:</span><span class="Cbackground"> </span>
<span class="Clinenum">   5:</span><span class="Cbackground"> </span><span class="Ccomment">(** [NoUnify] is raised when terms cannot be unified. *)</span>
<span class="Clinenum">   6:</span><span class="Cbackground"> </span><span class="Cexception">exception</span> <span class="Cconstructor">NoUnify</span>
<span class="Clinenum">   7:</span><span class="Cbackground"> </span>
<span class="Clinenum">   8:</span><span class="Cbackground"> </span><span class="Ccomment">(** [unify_terms env t1 t2] unifies terms [t1] and [t2] in the current</span>
<span class="Clinenum">   9:</span><span class="Cbackground"> </span><span class="Ccomment">    environment [env]. On success it returns the environment extended with</span>
<span class="Clinenum">  10:</span><span class="Cbackground"> </span><span class="Ccomment">    the result of unification. On failure it raises [NoUnify]. *)</span>
<span class="Clinenum">  11:</span><span class="Cbackground"> </span><span class="Clet">let</span> <span class="Crec">rec</span> unify_terms env t1 t2 <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  12:</span><span class="Cbackground"> </span>  <span class="Cmatch">match</span> subst_term env t1<span class="Cnonalphakeyword">,</span> subst_term env t2 <span class="Cwith">with</span>
<span class="Clinenum">  13:</span><span class="Cbackground"> </span>    <span class="Cbar">|</span> t1<span class="Cnonalphakeyword">,</span> t2 <span class="Cwhen">when</span> t1 <span class="Cnonalphakeyword">=</span> t2 <span class="Cnonalphakeyword">-&gt;</span> env
<span class="Clinenum">  14:</span><span class="Cbackground"> </span>    <span class="Cbar">|</span> <span class="Cnonalphakeyword">(</span><span class="Cconstructor">Var</span> y<span class="Cnonalphakeyword">,</span> t<span class="Cnonalphakeyword">)</span> <span class="Cbar">|</span> <span class="Cnonalphakeyword">(</span>t<span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Var</span> y<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span>
<span class="Clinenum">  15:</span><span class="Cbackground"> </span>        <span class="Cif">if</span> occurs y t <span class="Cthen">then</span>
<span class="Clinenum">  16:</span><span class="Cbackground"> </span>          raise <span class="Cconstructor">NoUnify</span>
<span class="Clinenum">  17:</span><span class="Cbackground"> </span>        <span class="Celse">else</span>
<span class="Clinenum">  18:</span><span class="Cbackground"> </span>          <span class="Cnonalphakeyword">(</span>y<span class="Cnonalphakeyword">,</span>t<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">::</span> env
<span class="Clinenum">  19:</span><span class="Cbackground"> </span>    <span class="Cbar">|</span> <span class="Cconstructor">Const</span> <span class="Cnonalphakeyword">_</span><span class="Cnonalphakeyword">,</span> <span class="Cnonalphakeyword">_</span> <span class="Cnonalphakeyword">-&gt;</span> raise <span class="Cconstructor">NoUnify</span>
<span class="Clinenum">  20:</span><span class="Cbackground"> </span>    <span class="Cbar">|</span> <span class="Cconstructor">App</span> <span class="Cnonalphakeyword">(</span>c1<span class="Cnonalphakeyword">,</span> ts1<span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">,</span> <span class="Cconstructor">App</span> <span class="Cnonalphakeyword">(</span>c2<span class="Cnonalphakeyword">,</span> ts2<span class="Cnonalphakeyword">)</span> <span class="Cwhen">when</span> c1 <span class="Cnonalphakeyword">=</span> c2 <span class="Cnonalphakeyword">-&gt;</span> unify_lists env ts1 ts2
<span class="Clinenum">  21:</span><span class="Cbackground"> </span>    <span class="Cbar">|</span> <span class="Cconstructor">App</span> <span class="Cnonalphakeyword">_</span><span class="Cnonalphakeyword">,</span> <span class="Cnonalphakeyword">_</span> <span class="Cnonalphakeyword">-&gt;</span> raise <span class="Cconstructor">NoUnify</span>
<span class="Clinenum">  22:</span><span class="Cbackground"> </span>
<span class="Clinenum">  23:</span><span class="Cbackground"> </span><span class="Ccomment">(** [unify_lists env lst1 lst2] unifies two lists of terms in current</span>
<span class="Clinenum">  24:</span><span class="Cbackground"> </span><span class="Ccomment">    environment [env] and returns a new environment [env'] on success. It</span>
<span class="Clinenum">  25:</span><span class="Cbackground"> </span><span class="Ccomment">    raises [NoUnify] on failure or if the lists are not of equal length.</span>
<span class="Clinenum">  26:</span><span class="Cbackground"> </span><span class="Ccomment">*)</span>
<span class="Clinenum">  27:</span><span class="Cbackground"> </span><span class="Cand">and</span> unify_lists env lst1 lst2 <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  28:</span><span class="Cbackground"> </span>  <span class="Ctry">try</span>
<span class="Clinenum">  29:</span><span class="Cbackground"> </span>    <span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>fold_left2 <span class="Cnonalphakeyword">(</span><span class="Cfun">fun</span> env t1 t2 <span class="Cnonalphakeyword">-&gt;</span> unify_terms env t1 t2<span class="Cnonalphakeyword">)</span> env lst1 lst2
<span class="Clinenum">  30:</span><span class="Cbackground"> </span>  <span class="Cwith">with</span> <span class="Cconstructor">Invalid_argument</span> <span class="Cnonalphakeyword">_</span> <span class="Cnonalphakeyword">-&gt;</span> raise <span class="Cconstructor">NoUnify</span>
<span class="Clinenum">  31:</span><span class="Cbackground"> </span>
<span class="Clinenum">  32:</span><span class="Cbackground"> </span><span class="Ccomment">(** [unify_atoms env a1 a2] unifies atomic propositions [a1] and [a2]</span>
<span class="Clinenum">  33:</span><span class="Cbackground"> </span><span class="Ccomment">    in current environment [env] and returns a new environment [env'] on</span>
<span class="Clinenum">  34:</span><span class="Cbackground"> </span><span class="Ccomment">    success. It raises [NoUnify] on failure. *)</span>
<span class="Clinenum">  35:</span><span class="Cbackground"> </span><span class="Clet">let</span> unify_atoms env <span class="Cnonalphakeyword">(</span>c1<span class="Cnonalphakeyword">,</span>ts1<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">(</span>c2<span class="Cnonalphakeyword">,</span>ts2<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  36:</span><span class="Cbackground"> </span>  <span class="Cif">if</span> c1 <span class="Cnonalphakeyword">=</span> c2 <span class="Cthen">then</span> unify_lists env ts1 ts2 <span class="Celse">else</span> raise <span class="Cconstructor">NoUnify</span>
</pre>

<hr>
<h1><a name="solve.ml"></a><code>solve.ml</code></h1>

<pre><span class="Clinenum">   1:</span><span class="Cbackground"> </span><span class="Ccomment">(** The prolog solver. *)</span>
<span class="Clinenum">   2:</span><span class="Cbackground"> </span>
<span class="Clinenum">   3:</span><span class="Cbackground"> </span><span class="Copen">open</span> <span class="Cconstructor">Syntax</span>
<span class="Clinenum">   4:</span><span class="Cbackground"> </span>
<span class="Clinenum">   5:</span><span class="Cbackground"> </span><span class="Ccomment">(** A value of type [choice] represents a choice point in the proof</span>
<span class="Clinenum">   6:</span><span class="Cbackground"> </span><span class="Ccomment">    search at which we may continue searching for another solution. It</span>
<span class="Clinenum">   7:</span><span class="Cbackground"> </span><span class="Ccomment">    is a tuple [(asrl, env, c, n)] where [asrl]</span>
<span class="Clinenum">   8:</span><span class="Cbackground"> </span><span class="Ccomment">    for other solutions of clause [c] in environment [env], using</span>
<span class="Clinenum">   9:</span><span class="Cbackground"> </span><span class="Ccomment">    assertion list [asrl], where [n] is the search depth. *)</span>
<span class="Clinenum">  10:</span><span class="Cbackground"> </span><span class="Ctype">type</span> choice <span class="Cnonalphakeyword">=</span> database <span class="Cnonalphakeyword">*</span> environment <span class="Cnonalphakeyword">*</span> clause <span class="Cnonalphakeyword">*</span> int
<span class="Clinenum">  11:</span><span class="Cbackground"> </span>
<span class="Clinenum">  12:</span><span class="Cbackground"> </span><span class="Ccomment">(** The global database of assertions. *)</span>
<span class="Clinenum">  13:</span><span class="Cbackground"> </span><span class="Clet">let</span> base <span class="Cnonalphakeyword">=</span> ref <span class="Cnonalphakeyword">(</span><span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span> : database<span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  14:</span><span class="Cbackground"> </span>
<span class="Clinenum">  15:</span><span class="Cbackground"> </span><span class="Ccomment">(** Add a new assertion at the end of the current database. *)</span>
<span class="Clinenum">  16:</span><span class="Cbackground"> </span><span class="Clet">let</span> assertz a <span class="Cnonalphakeyword">=</span> 
<span class="Clinenum">  17:</span><span class="Cbackground"> </span>  <span class="Clet">let</span> <span class="Crec">rec</span> add <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span> <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cnonalphakeyword">[</span>a<span class="Cnonalphakeyword">]</span> <span class="Cbar">|</span> b<span class="Cnonalphakeyword">::</span>bs <span class="Cnonalphakeyword">-&gt;</span> b<span class="Cnonalphakeyword">::</span><span class="Cnonalphakeyword">(</span>add bs<span class="Cnonalphakeyword">)</span> <span class="Cin">in</span>
<span class="Clinenum">  18:</span><span class="Cbackground"> </span>    <span class="Cnonalphakeyword">(</span>base <span class="Cnonalphakeyword">:=</span> add !base<span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  19:</span><span class="Cbackground"> </span>
<span class="Clinenum">  20:</span><span class="Cbackground"> </span><span class="Ccomment">(** Exception [NoSolution] is raised when a goal cannot be proved. *)</span>
<span class="Clinenum">  21:</span><span class="Cbackground"> </span><span class="Cexception">exception</span> <span class="Cconstructor">NoSolution</span>
<span class="Clinenum">  22:</span><span class="Cbackground"> </span>
<span class="Clinenum">  23:</span><span class="Cbackground"> </span><span class="Ccomment">(** [renumber_term n t] renumbers all variable instances occurring in</span>
<span class="Clinenum">  24:</span><span class="Cbackground"> </span><span class="Ccomment">    term [t] so that they have level [n]. *)</span>
<span class="Clinenum">  25:</span><span class="Cbackground"> </span><span class="Clet">let</span> <span class="Crec">rec</span> renumber_term n <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
<span class="Clinenum">  26:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Var</span> <span class="Cnonalphakeyword">(</span>x<span class="Cnonalphakeyword">,</span><span class="Cnonalphakeyword">_</span><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">Var</span> <span class="Cnonalphakeyword">(</span>x<span class="Cnonalphakeyword">,</span>n<span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  27:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Const</span> <span class="Cnonalphakeyword">_</span> <span class="Cas">as</span> c <span class="Cnonalphakeyword">-&gt;</span> c
<span class="Clinenum">  28:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">App</span> <span class="Cnonalphakeyword">(</span>c<span class="Cnonalphakeyword">,</span> ts<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">App</span> <span class="Cnonalphakeyword">(</span>c<span class="Cnonalphakeyword">,</span> <span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>map <span class="Cnonalphakeyword">(</span>renumber_term n<span class="Cnonalphakeyword">)</span> ts<span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  29:</span><span class="Cbackground"> </span>
<span class="Clinenum">  30:</span><span class="Cbackground"> </span><span class="Ccomment">(** [renumber_atom n a] renumbers all variable instances occurring in</span>
<span class="Clinenum">  31:</span><span class="Cbackground"> </span><span class="Ccomment">    atom [a] so that they have level [n]. *)</span>
<span class="Clinenum">  32:</span><span class="Cbackground"> </span><span class="Clet">let</span> <span class="Crec">rec</span> renumber_atom n <span class="Cnonalphakeyword">(</span>c<span class="Cnonalphakeyword">,</span>ts<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">=</span> <span class="Cnonalphakeyword">(</span>c<span class="Cnonalphakeyword">,</span> <span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>map <span class="Cnonalphakeyword">(</span>renumber_term n<span class="Cnonalphakeyword">)</span> ts<span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  33:</span><span class="Cbackground"> </span>
<span class="Clinenum">  34:</span><span class="Cbackground"> </span><span class="Ccomment">(** [display_solution ch env] displays the solution of a goal encoded</span>
<span class="Clinenum">  35:</span><span class="Cbackground"> </span><span class="Ccomment">    by [env]. It then gives the user the option to search for other</span>
<span class="Clinenum">  36:</span><span class="Cbackground"> </span><span class="Ccomment">    solutions, as described by the list of choice points [ch], or to abort</span>
<span class="Clinenum">  37:</span><span class="Cbackground"> </span><span class="Ccomment">    the current proof search. *)</span>
<span class="Clinenum">  38:</span><span class="Cbackground"> </span><span class="Clet">let</span> <span class="Crec">rec</span> display_solution ch env <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  39:</span><span class="Cbackground"> </span>  <span class="Cmatch">match</span> string_of_env env<span class="Cnonalphakeyword">,</span> ch <span class="Cwith">with</span>
<span class="Clinenum">  40:</span><span class="Cbackground"> </span>    <span class="Cbar">|</span> <span class="Cstring">"Yes"</span><span class="Cnonalphakeyword">,</span> <span class="Cnonalphakeyword">_</span> <span class="Cnonalphakeyword">-&gt;</span> print_endline <span class="Cstring">"Yes"</span>
<span class="Clinenum">  41:</span><span class="Cbackground"> </span>    <span class="Cbar">|</span> answer<span class="Cnonalphakeyword">,</span> <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">-&gt;</span> print_endline answer
<span class="Clinenum">  42:</span><span class="Cbackground"> </span>    <span class="Cbar">|</span> answer<span class="Cnonalphakeyword">,</span> ch <span class="Cnonalphakeyword">-&gt;</span> <span class="Cbegin">begin</span>
<span class="Clinenum">  43:</span><span class="Cbackground"> </span>        print_string <span class="Cnonalphakeyword">(</span>answer ^ <span class="Cstring">"\nmore? (y/n) [y] "</span><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  44:</span><span class="Cbackground"> </span>        flush stdout <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  45:</span><span class="Cbackground"> </span>        <span class="Cmatch">match</span> <span class="Cconstructor">String</span><span class="Cnonalphakeyword">.</span>lowercase <span class="Cnonalphakeyword">(</span>read_line <span class="Cnonalphakeyword">(</span><span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">)</span> <span class="Cwith">with</span>
<span class="Clinenum">  46:</span><span class="Cbackground"> </span>          <span class="Cbar">|</span> <span class="Cstring">"y"</span> <span class="Cbar">|</span> <span class="Cstring">"yes"</span> <span class="Cbar">|</span> <span class="Cstring">""</span> <span class="Cnonalphakeyword">-&gt;</span> continue_search ch
<span class="Clinenum">  47:</span><span class="Cbackground"> </span>          <span class="Cbar">|</span> <span class="Cnonalphakeyword">_</span> <span class="Cnonalphakeyword">-&gt;</span> raise <span class="Cconstructor">NoSolution</span>
<span class="Clinenum">  48:</span><span class="Cbackground"> </span>      <span class="Cend">end</span>
<span class="Clinenum">  49:</span><span class="Cbackground"> </span>
<span class="Clinenum">  50:</span><span class="Cbackground"> </span><span class="Ccomment">(** [continue_search ch] looks for other answers. It accepts a list of</span>
<span class="Clinenum">  51:</span><span class="Cbackground"> </span><span class="Ccomment">    choices [ch]. It continues the search at the first choice in the</span>
<span class="Clinenum">  52:</span><span class="Cbackground"> </span><span class="Ccomment">    list. *)</span>
<span class="Clinenum">  53:</span><span class="Cbackground"> </span><span class="Cand">and</span> continue_search <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
<span class="Clinenum">  54:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">-&gt;</span> raise <span class="Cconstructor">NoSolution</span>
<span class="Clinenum">  55:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cnonalphakeyword">(</span>asrl<span class="Cnonalphakeyword">,</span>env<span class="Cnonalphakeyword">,</span>gs<span class="Cnonalphakeyword">,</span>n<span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">::</span>cs <span class="Cnonalphakeyword">-&gt;</span> solve cs asrl env gs n
<span class="Clinenum">  56:</span><span class="Cbackground"> </span>
<span class="Clinenum">  57:</span><span class="Cbackground"> </span><span class="Ccomment">(** [solve ch asrl env c n] looks for the proof of clause [c]. Other</span>
<span class="Clinenum">  58:</span><span class="Cbackground"> </span><span class="Ccomment">    arguments are:</span>
<span class="Clinenum">  59:</span><span class="Cbackground"> </span><span class="Ccomment">    </span>
<span class="Clinenum">  60:</span><span class="Cbackground"> </span><span class="Ccomment">    [ch] is a list of choices at which we may look for other solutions,</span>
<span class="Clinenum">  61:</span><span class="Cbackground"> </span><span class="Ccomment"></span>
<span class="Clinenum">  62:</span><span class="Cbackground"> </span><span class="Ccomment">    [asrl] is the list of assertions that are used to reduce [c] to subgoals,</span>
<span class="Clinenum">  63:</span><span class="Cbackground"> </span><span class="Ccomment"></span>
<span class="Clinenum">  64:</span><span class="Cbackground"> </span><span class="Ccomment">    [env] is the current environment (values of variables),</span>
<span class="Clinenum">  65:</span><span class="Cbackground"> </span><span class="Ccomment"></span>
<span class="Clinenum">  66:</span><span class="Cbackground"> </span><span class="Ccomment">    [n] is the search depth, which is increased at each level of search.</span>
<span class="Clinenum">  67:</span><span class="Cbackground"> </span><span class="Ccomment"></span>
<span class="Clinenum">  68:</span><span class="Cbackground"> </span><span class="Ccomment">    When a solution is found, it is printed on the screen. The user</span>
<span class="Clinenum">  69:</span><span class="Cbackground"> </span><span class="Ccomment">    then decides whether other solutions should be searched for.</span>
<span class="Clinenum">  70:</span><span class="Cbackground"> </span><span class="Ccomment">*)</span>
<span class="Clinenum">  71:</span><span class="Cbackground"> </span><span class="Cand">and</span> solve ch asrl env c n <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  72:</span><span class="Cbackground"> </span>  <span class="Ccomment">(** [reduce_atom a asrl] reduces atom [a] to subgoals by using the</span>
<span class="Clinenum">  73:</span><span class="Cbackground"> </span><span class="Ccomment">      first assertion in the assetion list [asrl] whose conclusion matches</span>
<span class="Clinenum">  74:</span><span class="Cbackground"> </span><span class="Ccomment">      [a]. It returns [None] if the atom cannot be reduced, or the</span>
<span class="Clinenum">  75:</span><span class="Cbackground"> </span><span class="Ccomment">      remaining assertions, the new environment and the list of subgoals.</span>
<span class="Clinenum">  76:</span><span class="Cbackground"> </span><span class="Ccomment">  *)</span>
<span class="Clinenum">  77:</span><span class="Cbackground"> </span>  <span class="Clet">let</span> <span class="Crec">rec</span> reduce_atom a <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
<span class="Clinenum">  78:</span><span class="Cbackground"> </span>    <span class="Cbar">|</span> <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">None</span>
<span class="Clinenum">  79:</span><span class="Cbackground"> </span>    <span class="Cbar">|</span> <span class="Cnonalphakeyword">(</span>b<span class="Cnonalphakeyword">,</span>lst<span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">::</span>asrl' <span class="Cnonalphakeyword">-&gt;</span>
<span class="Clinenum">  80:</span><span class="Cbackground"> </span>        <span class="Cnonalphakeyword">(</span><span class="Ctry">try</span>
<span class="Clinenum">  81:</span><span class="Cbackground"> </span>           <span class="Clet">let</span> env' <span class="Cnonalphakeyword">=</span> <span class="Cconstructor">Unify</span><span class="Cnonalphakeyword">.</span>unify_atoms env a <span class="Cnonalphakeyword">(</span>renumber_atom n b<span class="Cnonalphakeyword">)</span> <span class="Cin">in</span>
<span class="Clinenum">  82:</span><span class="Cbackground"> </span>             <span class="Cconstructor">Some</span> <span class="Cnonalphakeyword">(</span>asrl'<span class="Cnonalphakeyword">,</span> env'<span class="Cnonalphakeyword">,</span> <span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>map <span class="Cnonalphakeyword">(</span>renumber_atom n<span class="Cnonalphakeyword">)</span> lst<span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  83:</span><span class="Cbackground"> </span>         <span class="Cwith">with</span> <span class="Cconstructor">Unify</span><span class="Cnonalphakeyword">.</span><span class="Cconstructor">NoUnify</span> <span class="Cnonalphakeyword">-&gt;</span> reduce_atom a asrl'<span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  84:</span><span class="Cbackground"> </span>  <span class="Cin">in</span>
<span class="Clinenum">  85:</span><span class="Cbackground"> </span>    <span class="Cmatch">match</span> c <span class="Cwith">with</span>
<span class="Clinenum">  86:</span><span class="Cbackground"> </span>      <span class="Cbar">|</span> <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">-&gt;</span>
<span class="Clinenum">  87:</span><span class="Cbackground"> </span>          <span class="Ccomment">(* All atoms are solved, we found a solution. *)</span>
<span class="Clinenum">  88:</span><span class="Cbackground"> </span>          display_solution ch env
<span class="Clinenum">  89:</span><span class="Cbackground"> </span>      <span class="Cbar">|</span> a<span class="Cnonalphakeyword">::</span>c' <span class="Cnonalphakeyword">-&gt;</span>
<span class="Clinenum">  90:</span><span class="Cbackground"> </span>          <span class="Ccomment">(* Reduce the first atom in the clause. *)</span>
<span class="Clinenum">  91:</span><span class="Cbackground"> </span>          <span class="Cnonalphakeyword">(</span><span class="Cmatch">match</span> reduce_atom a asrl <span class="Cwith">with</span>
<span class="Clinenum">  92:</span><span class="Cbackground"> </span>             <span class="Cbar">|</span> <span class="Cconstructor">None</span> <span class="Cnonalphakeyword">-&gt;</span> 
<span class="Clinenum">  93:</span><span class="Cbackground"> </span>                 <span class="Ccomment">(* This clause cannot be solved, look for other solutions. *)</span>
<span class="Clinenum">  94:</span><span class="Cbackground"> </span>                 continue_search ch
<span class="Clinenum">  95:</span><span class="Cbackground"> </span>             <span class="Cbar">|</span> <span class="Cconstructor">Some</span> <span class="Cnonalphakeyword">(</span>asrl'<span class="Cnonalphakeyword">,</span> env'<span class="Cnonalphakeyword">,</span> d<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span>
<span class="Clinenum">  96:</span><span class="Cbackground"> </span>                 <span class="Ccomment">(* The atom was reduced to subgoals [d]. Continue</span>
<span class="Clinenum">  97:</span><span class="Cbackground"> </span><span class="Ccomment"></span>        <span class="Ccomment"></span>        <span class="Ccomment">    search with the subgoals added to the list of</span>
<span class="Clinenum">  98:</span><span class="Cbackground"> </span><span class="Ccomment"></span>        <span class="Ccomment"></span>        <span class="Ccomment">    goals. *)</span>
<span class="Clinenum">  99:</span><span class="Cbackground"> </span>                 <span class="Clet">let</span> ch' <span class="Cnonalphakeyword">=</span> <span class="Cnonalphakeyword">(</span>asrl'<span class="Cnonalphakeyword">,</span> env<span class="Cnonalphakeyword">,</span> c<span class="Cnonalphakeyword">,</span> n<span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">::</span>ch <span class="Ccomment">(* Add a new choice. *)</span>
<span class="Clinenum"> 100:</span><span class="Cbackground"> </span>                 <span class="Cin">in</span>
<span class="Clinenum"> 101:</span><span class="Cbackground"> </span>                   solve ch' !base env' <span class="Cnonalphakeyword">(</span>d @ c'<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">(</span>n<span class="Cnonalphakeyword">+</span>1<span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">)</span>
<span class="Clinenum"> 102:</span><span class="Cbackground"> </span>
<span class="Clinenum"> 103:</span><span class="Cbackground"> </span><span class="Ccomment">(** [solve_toplevel c] searches for the proof of clause [c] using the</span>
<span class="Clinenum"> 104:</span><span class="Cbackground"> </span><span class="Ccomment">    global databased [!base]. This function is called from the main</span>
<span class="Clinenum"> 105:</span><span class="Cbackground"> </span><span class="Ccomment">    program. *)</span>
<span class="Clinenum"> 106:</span><span class="Cbackground"> </span><span class="Clet">let</span> solve_toplevel c <span class="Cnonalphakeyword">=</span>
<span class="Clinenum"> 107:</span><span class="Cbackground"> </span>  <span class="Ctry">try</span>
<span class="Clinenum"> 108:</span><span class="Cbackground"> </span>    solve <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span> !base <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span> c 1
<span class="Clinenum"> 109:</span><span class="Cbackground"> </span>  <span class="Cwith">with</span> <span class="Cconstructor">NoSolution</span> <span class="Cnonalphakeyword">-&gt;</span> print_endline <span class="Cstring">"No"</span>
</pre>

<hr>
<h1><a name="lexer.mll"></a><code>lexer.mll</code></h1>

<pre><span class="Clinenum">   1:</span><span class="Cbackground"> </span><span class="Cnonalphakeyword">{</span>
<span class="Clinenum">   2:</span><span class="Cbackground"> </span>  <span class="Copen">open</span> <span class="Cconstructor">Parser</span>
<span class="Clinenum">   3:</span><span class="Cbackground"> </span>  <span class="Copen">open</span> <span class="Cconstructor">Lexing</span>
<span class="Clinenum">   4:</span><span class="Cbackground"> </span>
<span class="Clinenum">   5:</span><span class="Cbackground"> </span>  <span class="Clet">let</span> incr_linenum lexbuf <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">   6:</span><span class="Cbackground"> </span>    <span class="Clet">let</span> pos <span class="Cnonalphakeyword">=</span> lexbuf<span class="Cnonalphakeyword">.</span>lex_curr_p <span class="Cin">in</span>
<span class="Clinenum">   7:</span><span class="Cbackground"> </span>    lexbuf<span class="Cnonalphakeyword">.</span>lex_curr_p <span class="Cnonalphakeyword">&lt;-</span> <span class="Cnonalphakeyword">{</span> pos <span class="Cwith">with</span>
<span class="Clinenum">   8:</span><span class="Cbackground"> </span>      pos_lnum <span class="Cnonalphakeyword">=</span> pos<span class="Cnonalphakeyword">.</span>pos_lnum <span class="Cnonalphakeyword">+</span> 1<span class="Cnonalphakeyword">;</span>
<span class="Clinenum">   9:</span><span class="Cbackground"> </span>      pos_bol <span class="Cnonalphakeyword">=</span> pos<span class="Cnonalphakeyword">.</span>pos_cnum<span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  10:</span><span class="Cbackground"> </span>    <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  11:</span><span class="Cbackground"> </span><span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  12:</span><span class="Cbackground"> </span>
<span class="Clinenum">  13:</span><span class="Cbackground"> </span><span class="Clet">let</span> const <span class="Cnonalphakeyword">=</span> <span class="Cnonalphakeyword">[</span><span class="Cstring">'a'</span><span class="Cnonalphakeyword">-</span><span class="Cstring">'z'</span><span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">[</span><span class="Cstring">'_'</span> <span class="Cstring">'a'</span><span class="Cnonalphakeyword">-</span><span class="Cstring">'z'</span> <span class="Cstring">'A'</span><span class="Cnonalphakeyword">-</span><span class="Cstring">'Z'</span> <span class="Cstring">'0'</span><span class="Cnonalphakeyword">-</span><span class="Cstring">'9'</span><span class="Cnonalphakeyword">]</span><span class="Cnonalphakeyword">*</span>
<span class="Clinenum">  14:</span><span class="Cbackground"> </span><span class="Clet">let</span> var <span class="Cnonalphakeyword">=</span> <span class="Cnonalphakeyword">[</span><span class="Cstring">'A'</span><span class="Cnonalphakeyword">-</span><span class="Cstring">'Z'</span><span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">[</span><span class="Cstring">'_'</span> <span class="Cstring">'a'</span><span class="Cnonalphakeyword">-</span><span class="Cstring">'z'</span> <span class="Cstring">'A'</span><span class="Cnonalphakeyword">-</span><span class="Cstring">'Z'</span> <span class="Cstring">'0'</span><span class="Cnonalphakeyword">-</span><span class="Cstring">'9'</span><span class="Cnonalphakeyword">]</span><span class="Cnonalphakeyword">*</span>
<span class="Clinenum">  15:</span><span class="Cbackground"> </span>
<span class="Clinenum">  16:</span><span class="Cbackground"> </span>
<span class="Clinenum">  17:</span><span class="Cbackground"> </span>rule token <span class="Cnonalphakeyword">=</span> parse
<span class="Clinenum">  18:</span><span class="Cbackground"> </span>    <span class="Cstring">'#'</span> <span class="Cnonalphakeyword">[</span>^<span class="Cstring">'\n'</span><span class="Cnonalphakeyword">]</span><span class="Cnonalphakeyword">*</span> <span class="Cstring">'\n'</span> <span class="Cnonalphakeyword">{</span> incr_linenum lexbuf<span class="Cnonalphakeyword">;</span> token lexbuf <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  19:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cstring">'\n'</span>            <span class="Cnonalphakeyword">{</span> incr_linenum lexbuf<span class="Cnonalphakeyword">;</span> token lexbuf <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  20:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cnonalphakeyword">[</span><span class="Cstring">' '</span> <span class="Cstring">'\t'</span><span class="Cnonalphakeyword">]</span>      <span class="Cnonalphakeyword">{</span> token lexbuf <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  21:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cstring">"$use"</span>          <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">USE</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  22:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cstring">"$quit"</span>         <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">QUIT</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  23:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cstring">"?-"</span>            <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">GOAL</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  24:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cstring">":-"</span>            <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">FROM</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  25:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cstring">";;"</span>            <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">SEMICOLON2</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  26:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cstring">"true"</span>          <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">TRUE</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  27:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cstring">'\"'</span> <span class="Cnonalphakeyword">[</span>^<span class="Cstring">'\"'</span><span class="Cnonalphakeyword">]</span><span class="Cnonalphakeyword">*</span> <span class="Cstring">'\"'</span> <span class="Cnonalphakeyword">{</span> <span class="Clet">let</span> str <span class="Cnonalphakeyword">=</span> lexeme lexbuf <span class="Cin">in</span>
<span class="Clinenum">  28:</span><span class="Cbackground"> </span>                        <span class="Cconstructor">STRING</span> <span class="Cnonalphakeyword">(</span><span class="Cconstructor">String</span><span class="Cnonalphakeyword">.</span>sub str 1 <span class="Cnonalphakeyword">(</span><span class="Cconstructor">String</span><span class="Cnonalphakeyword">.</span>length str <span class="Cnonalphakeyword">-</span> 2<span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  29:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cstring">'('</span>             <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">LPAREN</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  30:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cstring">')'</span>             <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">RPAREN</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  31:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cstring">','</span>             <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">COMMA</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  32:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cstring">'.'</span>             <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">PERIOD</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  33:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> const           <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">CONST</span> <span class="Cnonalphakeyword">(</span>lexeme lexbuf<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  34:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> var             <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">VAR</span> <span class="Cnonalphakeyword">(</span>lexeme lexbuf<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  35:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> eof             <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">EOF</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  36:</span><span class="Cbackground"> </span>
<span class="Clinenum">  37:</span><span class="Cbackground"> </span><span class="Cnonalphakeyword">{</span>
<span class="Clinenum">  38:</span><span class="Cbackground"> </span><span class="Cnonalphakeyword">}</span>
</pre>

<hr>
<h1><a name="parser.mly"></a><code>parser.mly</code></h1>

<pre><span class="Clinenum">   1:</span><span class="Cbackground"> </span>%<span class="Cnonalphakeyword">{</span>
<span class="Clinenum">   2:</span><span class="Cbackground"> </span>  <span class="Copen">open</span> <span class="Cconstructor">Syntax</span>
<span class="Clinenum">   3:</span><span class="Cbackground"> </span>%<span class="Cnonalphakeyword">}</span>
<span class="Clinenum">   4:</span><span class="Cbackground"> </span>
<span class="Clinenum">   5:</span><span class="Cbackground"> </span>%token <span class="Cnonalphakeyword">&lt;</span>string<span class="Cnonalphakeyword">&gt;</span><span class="Cconstructor">VAR</span>
<span class="Clinenum">   6:</span><span class="Cbackground"> </span>%token <span class="Cnonalphakeyword">&lt;</span>string<span class="Cnonalphakeyword">&gt;</span><span class="Cconstructor">CONST</span>
<span class="Clinenum">   7:</span><span class="Cbackground"> </span>%token <span class="Cconstructor">FROM</span>
<span class="Clinenum">   8:</span><span class="Cbackground"> </span>%token <span class="Cconstructor">COMMA</span>
<span class="Clinenum">   9:</span><span class="Cbackground"> </span>%token <span class="Cconstructor">TRUE</span>
<span class="Clinenum">  10:</span><span class="Cbackground"> </span>%token <span class="Cconstructor">PERIOD</span>
<span class="Clinenum">  11:</span><span class="Cbackground"> </span>%token <span class="Cconstructor">LPAREN</span> <span class="Cconstructor">RPAREN</span>
<span class="Clinenum">  12:</span><span class="Cbackground"> </span>%token <span class="Cconstructor">GOAL</span>
<span class="Clinenum">  13:</span><span class="Cbackground"> </span>%token <span class="Cconstructor">QUIT</span>
<span class="Clinenum">  14:</span><span class="Cbackground"> </span>%token <span class="Cconstructor">SEMICOLON2</span>
<span class="Clinenum">  15:</span><span class="Cbackground"> </span>%token <span class="Cconstructor">USE</span>
<span class="Clinenum">  16:</span><span class="Cbackground"> </span>%token <span class="Cnonalphakeyword">&lt;</span>string<span class="Cnonalphakeyword">&gt;</span><span class="Cconstructor">STRING</span>
<span class="Clinenum">  17:</span><span class="Cbackground"> </span>%token <span class="Cconstructor">EOF</span>
<span class="Clinenum">  18:</span><span class="Cbackground"> </span>
<span class="Clinenum">  19:</span><span class="Cbackground"> </span>%start toplevel
<span class="Clinenum">  20:</span><span class="Cbackground"> </span>%<span class="Ctype">type</span> <span class="Cnonalphakeyword">&lt;</span><span class="Cconstructor">Syntax</span><span class="Cnonalphakeyword">.</span>toplevel_cmd list<span class="Cnonalphakeyword">&gt;</span> toplevel
<span class="Clinenum">  21:</span><span class="Cbackground"> </span>
<span class="Clinenum">  22:</span><span class="Cbackground"> </span>%right <span class="Cconstructor">SEMICOLON2</span>
<span class="Clinenum">  23:</span><span class="Cbackground"> </span>%nonassoc <span class="Cconstructor">PERIOD</span> <span class="Cconstructor">GOAL</span> <span class="Cconstructor">IMPLIED</span>
<span class="Clinenum">  24:</span><span class="Cbackground"> </span>%right <span class="Cconstructor">COMMA</span>
<span class="Clinenum">  25:</span><span class="Cbackground"> </span>
<span class="Clinenum">  26:</span><span class="Cbackground"> </span>%%
<span class="Clinenum">  27:</span><span class="Cbackground"> </span>
<span class="Clinenum">  28:</span><span class="Cbackground"> </span>toplevel:
<span class="Clinenum">  29:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">EOF</span>                      <span class="Cnonalphakeyword">{</span> <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  30:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> exprtop                  <span class="Cnonalphakeyword">{</span> $1 <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  31:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> cmdtop                   <span class="Cnonalphakeyword">{</span> $1 <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  32:</span><span class="Cbackground"> </span>
<span class="Clinenum">  33:</span><span class="Cbackground"> </span>exprtop:
<span class="Clinenum">  34:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> expr <span class="Cconstructor">EOF</span>                 <span class="Cnonalphakeyword">{</span> <span class="Cnonalphakeyword">[</span>$1<span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  35:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> expr toplevel            <span class="Cnonalphakeyword">{</span> $1 <span class="Cnonalphakeyword">::</span> $2 <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  36:</span><span class="Cbackground"> </span>
<span class="Clinenum">  37:</span><span class="Cbackground"> </span>cmdtop:
<span class="Clinenum">  38:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> cmd <span class="Cconstructor">EOF</span>                  <span class="Cnonalphakeyword">{</span> <span class="Cnonalphakeyword">[</span>$1<span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  39:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> cmd toplevel             <span class="Cnonalphakeyword">{</span> $1 <span class="Cnonalphakeyword">::</span> $2 <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  40:</span><span class="Cbackground"> </span>
<span class="Clinenum">  41:</span><span class="Cbackground"> </span>cmd:
<span class="Clinenum">  42:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">USE</span> <span class="Cconstructor">STRING</span> <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">Use</span> $2 <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  43:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">QUIT</span>       <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">Quit</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  44:</span><span class="Cbackground"> </span>
<span class="Clinenum">  45:</span><span class="Cbackground"> </span>expr:
<span class="Clinenum">  46:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> goal      <span class="Cnonalphakeyword">{</span> $1 <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  47:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> assertion <span class="Cnonalphakeyword">{</span> $1 <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  48:</span><span class="Cbackground"> </span>
<span class="Clinenum">  49:</span><span class="Cbackground"> </span>goal:
<span class="Clinenum">  50:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">GOAL</span> clause <span class="Cconstructor">PERIOD</span>        <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">Goal</span> $2 <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  51:</span><span class="Cbackground"> </span>
<span class="Clinenum">  52:</span><span class="Cbackground"> </span>assertion:
<span class="Clinenum">  53:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> atom <span class="Cconstructor">PERIOD</span>               <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">Assert</span> <span class="Cnonalphakeyword">(</span>$1<span class="Cnonalphakeyword">,</span> <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  54:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> atom <span class="Cconstructor">FROM</span> clause <span class="Cconstructor">PERIOD</span>   <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">Assert</span> <span class="Cnonalphakeyword">(</span>$1<span class="Cnonalphakeyword">,</span> $3<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  55:</span><span class="Cbackground"> </span>
<span class="Clinenum">  56:</span><span class="Cbackground"> </span>atom:
<span class="Clinenum">  57:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">CONST</span>                     <span class="Cnonalphakeyword">{</span> <span class="Cnonalphakeyword">(</span>$1<span class="Cnonalphakeyword">,</span> <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  58:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">CONST</span> <span class="Cconstructor">LPAREN</span> args <span class="Cconstructor">RPAREN</span>  <span class="Cnonalphakeyword">{</span> <span class="Cnonalphakeyword">(</span>$1<span class="Cnonalphakeyword">,</span> $3<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  59:</span><span class="Cbackground"> </span>
<span class="Clinenum">  60:</span><span class="Cbackground"> </span>clause:
<span class="Clinenum">  61:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">TRUE</span>                      <span class="Cnonalphakeyword">{</span> <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  62:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> atom                      <span class="Cnonalphakeyword">{</span> <span class="Cnonalphakeyword">[</span>$1<span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  63:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> atom <span class="Cconstructor">COMMA</span> clause         <span class="Cnonalphakeyword">{</span> $1 <span class="Cnonalphakeyword">::</span> $3 <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  64:</span><span class="Cbackground"> </span>
<span class="Clinenum">  65:</span><span class="Cbackground"> </span>args:
<span class="Clinenum">  66:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> literal            <span class="Cnonalphakeyword">{</span> <span class="Cnonalphakeyword">[</span>$1<span class="Cnonalphakeyword">]</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  67:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> literal <span class="Cconstructor">COMMA</span> args <span class="Cnonalphakeyword">{</span> $1 <span class="Cnonalphakeyword">::</span> $3 <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  68:</span><span class="Cbackground"> </span>
<span class="Clinenum">  69:</span><span class="Cbackground"> </span>literal:
<span class="Clinenum">  70:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">CONST</span>                    <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">Const</span> $1 <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  71:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">VAR</span>                      <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">Var</span> <span class="Cnonalphakeyword">(</span>$1<span class="Cnonalphakeyword">,</span> 0<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  72:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">CONST</span> <span class="Cconstructor">LPAREN</span> args <span class="Cconstructor">RPAREN</span> <span class="Cnonalphakeyword">{</span> <span class="Cconstructor">App</span> <span class="Cnonalphakeyword">(</span>$1<span class="Cnonalphakeyword">,</span> $3<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">}</span>
<span class="Clinenum">  73:</span><span class="Cbackground"> </span>
<span class="Clinenum">  74:</span><span class="Cbackground"> </span>
<span class="Clinenum">  75:</span><span class="Cbackground"> </span>%%
</pre>

<hr>
<h1><a name="message.ml"></a><code>message.ml</code></h1>

<pre><span class="Clinenum">   1:</span><span class="Cbackground"> </span><span class="Ccomment">(** Error messages. *)</span>
<span class="Clinenum">   2:</span><span class="Cbackground"> </span>
<span class="Clinenum">   3:</span><span class="Cbackground"> </span><span class="Copen">open</span> <span class="Cconstructor">Lexing</span>
<span class="Clinenum">   4:</span><span class="Cbackground"> </span>
<span class="Clinenum">   5:</span><span class="Cbackground"> </span><span class="Ccomment">(** [lexer_from_channel fn ch] returns a lexer stream which takes</span>
<span class="Clinenum">   6:</span><span class="Cbackground"> </span><span class="Ccomment">    input from channel [ch]. The filename (for reporting errors) is</span>
<span class="Clinenum">   7:</span><span class="Cbackground"> </span><span class="Ccomment">    set to [fn].</span>
<span class="Clinenum">   8:</span><span class="Cbackground"> </span><span class="Ccomment">*)</span>
<span class="Clinenum">   9:</span><span class="Cbackground"> </span><span class="Clet">let</span> lexer_from_channel fn ch <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  10:</span><span class="Cbackground"> </span>  <span class="Clet">let</span> lex <span class="Cnonalphakeyword">=</span> <span class="Cconstructor">Lexing</span><span class="Cnonalphakeyword">.</span>from_channel ch <span class="Cin">in</span>
<span class="Clinenum">  11:</span><span class="Cbackground"> </span>  <span class="Clet">let</span> pos <span class="Cnonalphakeyword">=</span> lex<span class="Cnonalphakeyword">.</span>lex_curr_p <span class="Cin">in</span>
<span class="Clinenum">  12:</span><span class="Cbackground"> </span>    lex<span class="Cnonalphakeyword">.</span>lex_curr_p <span class="Cnonalphakeyword">&lt;-</span> <span class="Cnonalphakeyword">{</span> pos <span class="Cwith">with</span> pos_fname <span class="Cnonalphakeyword">=</span> fn<span class="Cnonalphakeyword">;</span> pos_lnum <span class="Cnonalphakeyword">=</span> 1<span class="Cnonalphakeyword">;</span> <span class="Cnonalphakeyword">}</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  13:</span><span class="Cbackground"> </span>    lex
<span class="Clinenum">  14:</span><span class="Cbackground"> </span>
<span class="Clinenum">  15:</span><span class="Cbackground"> </span><span class="Ccomment">(** [lexer_from_string str] returns a lexer stream which takes input</span>
<span class="Clinenum">  16:</span><span class="Cbackground"> </span><span class="Ccomment">    from a string [str]. The filename (for reporting errors) is set to</span>
<span class="Clinenum">  17:</span><span class="Cbackground"> </span><span class="Ccomment">    [""]. *)</span>
<span class="Clinenum">  18:</span><span class="Cbackground"> </span><span class="Clet">let</span> lexer_from_string str <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  19:</span><span class="Cbackground"> </span>  <span class="Clet">let</span> lex <span class="Cnonalphakeyword">=</span> <span class="Cconstructor">Lexing</span><span class="Cnonalphakeyword">.</span>from_string str <span class="Cin">in</span>
<span class="Clinenum">  20:</span><span class="Cbackground"> </span>  <span class="Clet">let</span> pos <span class="Cnonalphakeyword">=</span> lex<span class="Cnonalphakeyword">.</span>lex_curr_p <span class="Cin">in</span>
<span class="Clinenum">  21:</span><span class="Cbackground"> </span>    lex<span class="Cnonalphakeyword">.</span>lex_curr_p <span class="Cnonalphakeyword">&lt;-</span> <span class="Cnonalphakeyword">{</span> pos <span class="Cwith">with</span> pos_fname <span class="Cnonalphakeyword">=</span> <span class="Cstring">""</span><span class="Cnonalphakeyword">;</span> pos_lnum <span class="Cnonalphakeyword">=</span> 1<span class="Cnonalphakeyword">;</span> <span class="Cnonalphakeyword">}</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  22:</span><span class="Cbackground"> </span>    lex
<span class="Clinenum">  23:</span><span class="Cbackground"> </span>
<span class="Clinenum">  24:</span><span class="Cbackground"> </span><span class="Clet">let</span> string_of_position <span class="Cnonalphakeyword">{</span>pos_fname<span class="Cnonalphakeyword">=</span>fn<span class="Cnonalphakeyword">;</span> pos_lnum<span class="Cnonalphakeyword">=</span>ln<span class="Cnonalphakeyword">;</span> pos_bol<span class="Cnonalphakeyword">=</span>bol<span class="Cnonalphakeyword">;</span> pos_cnum<span class="Cnonalphakeyword">=</span>cn<span class="Cnonalphakeyword">}</span> <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  25:</span><span class="Cbackground"> </span>  <span class="Clet">let</span> c <span class="Cnonalphakeyword">=</span> cn <span class="Cnonalphakeyword">-</span> bol <span class="Cin">in</span>
<span class="Clinenum">  26:</span><span class="Cbackground"> </span>    <span class="Cif">if</span> fn <span class="Cnonalphakeyword">=</span> <span class="Cstring">""</span> <span class="Cthen">then</span>
<span class="Clinenum">  27:</span><span class="Cbackground"> </span>      <span class="Cstring">"Character "</span> ^ string_of_int c
<span class="Clinenum">  28:</span><span class="Cbackground"> </span>    <span class="Celse">else</span>
<span class="Clinenum">  29:</span><span class="Cbackground"> </span>      <span class="Cstring">"File \""</span> ^ fn ^ <span class="Cstring">"\", line "</span> ^ string_of_int ln ^ <span class="Cstring">", character "</span> ^ string_of_int c
<span class="Clinenum">  30:</span><span class="Cbackground"> </span>
<span class="Clinenum">  31:</span><span class="Cbackground"> </span><span class="Clet">let</span> string_of msg pos <span class="Cnonalphakeyword">=</span> string_of_position pos ^ <span class="Cstring">":\n"</span> ^ msg
<span class="Clinenum">  32:</span><span class="Cbackground"> </span>
<span class="Clinenum">  33:</span><span class="Cbackground"> </span><span class="Clet">let</span> syntax_error <span class="Cnonalphakeyword">{</span>lex_curr_p<span class="Cnonalphakeyword">=</span>pos<span class="Cnonalphakeyword">}</span> <span class="Cnonalphakeyword">=</span> string_of <span class="Cstring">"Syntax error"</span> pos
<span class="Clinenum">  34:</span><span class="Cbackground"> </span>
<span class="Clinenum">  35:</span><span class="Cbackground"> </span><span class="Clet">let</span> report <span class="Cnonalphakeyword">=</span> print_endline
</pre>

<hr>
<h1><a name="miniprolog.ml"></a><code>miniprolog.ml</code></h1>

<pre><span class="Clinenum">   1:</span><span class="Cbackground"> </span><span class="Ccomment">(** Miniprolog toplevel. *)</span>
<span class="Clinenum">   2:</span><span class="Cbackground"> </span>
<span class="Clinenum">   3:</span><span class="Cbackground"> </span><span class="Copen">open</span> <span class="Cconstructor">Message</span>
<span class="Clinenum">   4:</span><span class="Cbackground"> </span><span class="Copen">open</span> <span class="Cconstructor">Syntax</span>
<span class="Clinenum">   5:</span><span class="Cbackground"> </span>
<span class="Clinenum">   6:</span><span class="Cbackground"> </span><span class="Ccomment">(**</span>
<span class="Clinenum">   7:</span><span class="Cbackground"> </span><span class="Ccomment">  The toplevel accepts global value definitions [let x = e] and expressions,</span>
<span class="Clinenum">   8:</span><span class="Cbackground"> </span><span class="Ccomment">  separated by double semicolons [;;] when contained in a file.</span>
<span class="Clinenum">   9:</span><span class="Cbackground"> </span><span class="Ccomment"></span>
<span class="Clinenum">  10:</span><span class="Cbackground"> </span><span class="Ccomment">  Usage:</span>
<span class="Clinenum">  11:</span><span class="Cbackground"> </span><span class="Ccomment"></span>
<span class="Clinenum">  12:</span><span class="Cbackground"> </span><span class="Ccomment">    [miniprolog] runs the interactive loop</span>
<span class="Clinenum">  13:</span><span class="Cbackground"> </span><span class="Ccomment"></span>
<span class="Clinenum">  14:</span><span class="Cbackground"> </span><span class="Ccomment">    [miniprolog dat1 ... datN] evaluates the contents of files</span>
<span class="Clinenum">  15:</span><span class="Cbackground"> </span><span class="Ccomment">    [dat1], ..., [datN] then runs the interactive loop.</span>
<span class="Clinenum">  16:</span><span class="Cbackground"> </span><span class="Ccomment"></span>
<span class="Clinenum">  17:</span><span class="Cbackground"> </span><span class="Ccomment">    [miniprolog -n dat1 ..., datN] evaluates the contents of files</span>
<span class="Clinenum">  18:</span><span class="Cbackground"> </span><span class="Ccomment">    [dat1],...,[datN] and exits.</span>
<span class="Clinenum">  19:</span><span class="Cbackground"> </span><span class="Ccomment">*)</span>
<span class="Clinenum">  20:</span><span class="Cbackground"> </span>
<span class="Clinenum">  21:</span><span class="Cbackground"> </span><span class="Cexception">exception</span> <span class="Cconstructor">Fatal_error</span> <span class="Cof">of</span> string
<span class="Clinenum">  22:</span><span class="Cbackground"> </span>
<span class="Clinenum">  23:</span><span class="Cbackground"> </span><span class="Clet">let</span> fatal_error msg <span class="Cnonalphakeyword">=</span> raise <span class="Cnonalphakeyword">(</span><span class="Cconstructor">Fatal_error</span> msg<span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  24:</span><span class="Cbackground"> </span>
<span class="Clinenum">  25:</span><span class="Cbackground"> </span><span class="Ccomment">(** [exec_cmd cmd] executes the toplevel command [cmd]. *)</span>
<span class="Clinenum">  26:</span><span class="Cbackground"> </span><span class="Clet">let</span> <span class="Crec">rec</span> exec_cmd <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
<span class="Clinenum">  27:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Goal</span> g <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">Solve</span><span class="Cnonalphakeyword">.</span>solve_toplevel g
<span class="Clinenum">  28:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Assert</span> a <span class="Cnonalphakeyword">-&gt;</span>  <span class="Cconstructor">Solve</span><span class="Cnonalphakeyword">.</span>assertz a
<span class="Clinenum">  29:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Quit</span> <span class="Cnonalphakeyword">-&gt;</span> raise <span class="Cconstructor">End_of_file</span>
<span class="Clinenum">  30:</span><span class="Cbackground"> </span>  <span class="Cbar">|</span> <span class="Cconstructor">Use</span> fn <span class="Cnonalphakeyword">-&gt;</span> exec_file fn
<span class="Clinenum">  31:</span><span class="Cbackground"> </span>
<span class="Clinenum">  32:</span><span class="Cbackground"> </span><span class="Ccomment">(** [exec_file fn] executes the contents of file [fn]. *)</span>
<span class="Clinenum">  33:</span><span class="Cbackground"> </span><span class="Cand">and</span> exec_file fn <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  34:</span><span class="Cbackground"> </span>  <span class="Clet">let</span> fh <span class="Cnonalphakeyword">=</span> open_in fn <span class="Cin">in</span>
<span class="Clinenum">  35:</span><span class="Cbackground"> </span>  <span class="Clet">let</span> lex <span class="Cnonalphakeyword">=</span> <span class="Cconstructor">Message</span><span class="Cnonalphakeyword">.</span>lexer_from_channel fn fh <span class="Cin">in</span>
<span class="Clinenum">  36:</span><span class="Cbackground"> </span>    <span class="Ctry">try</span>
<span class="Clinenum">  37:</span><span class="Cbackground"> </span>      <span class="Clet">let</span> cmds <span class="Cnonalphakeyword">=</span> <span class="Cconstructor">Parser</span><span class="Cnonalphakeyword">.</span>toplevel <span class="Cconstructor">Lexer</span><span class="Cnonalphakeyword">.</span>token lex <span class="Cin">in</span>
<span class="Clinenum">  38:</span><span class="Cbackground"> </span>        close_in fh <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  39:</span><span class="Cbackground"> </span>        exec_cmds cmds
<span class="Clinenum">  40:</span><span class="Cbackground"> </span>    <span class="Cwith">with</span>
<span class="Clinenum">  41:</span><span class="Cbackground"> </span>      <span class="Cbar">|</span> <span class="Cconstructor">Sys</span><span class="Cnonalphakeyword">.</span><span class="Cconstructor">Break</span> <span class="Cnonalphakeyword">-&gt;</span> fatal_error <span class="Cstring">"Interrupted."</span>
<span class="Clinenum">  42:</span><span class="Cbackground"> </span>      <span class="Cbar">|</span> <span class="Cconstructor">Parsing</span><span class="Cnonalphakeyword">.</span><span class="Cconstructor">Parse_error</span> <span class="Cbar">|</span> <span class="Cconstructor">Failure</span><span class="Cnonalphakeyword">(</span><span class="Cstring">"lexing: empty token"</span><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span>
<span class="Clinenum">  43:</span><span class="Cbackground"> </span>          fatal_error <span class="Cnonalphakeyword">(</span><span class="Cconstructor">Message</span><span class="Cnonalphakeyword">.</span>syntax_error lex<span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  44:</span><span class="Cbackground"> </span>
<span class="Clinenum">  45:</span><span class="Cbackground"> </span><span class="Ccomment">(** [exec_cmds cmds] executes the list of toplevel commands [cmds]. *)</span>
<span class="Clinenum">  46:</span><span class="Cbackground"> </span><span class="Cand">and</span> exec_cmds cmds <span class="Cnonalphakeyword">=</span> <span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>iter exec_cmd cmds
<span class="Clinenum">  47:</span><span class="Cbackground"> </span><span class="Cnonalphakeyword">;;</span>
<span class="Clinenum">  48:</span><span class="Cbackground"> </span>
<span class="Clinenum">  49:</span><span class="Cbackground"> </span><span class="Ccomment">(** [shell ()] is the interactive shell. *)</span>
<span class="Clinenum">  50:</span><span class="Cbackground"> </span><span class="Clet">let</span> shell <span class="Cnonalphakeyword">(</span><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  51:</span><span class="Cbackground"> </span>  print_string <span class="Cnonalphakeyword">(</span><span class="Cstring">"Miniprolog. Press "</span><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  52:</span><span class="Cbackground"> </span>  print_string <span class="Cnonalphakeyword">(</span><span class="Cmatch">match</span> <span class="Cconstructor">Sys</span><span class="Cnonalphakeyword">.</span>os_type <span class="Cwith">with</span>
<span class="Clinenum">  53:</span><span class="Cbackground"> </span>                    <span class="Cstring">"Unix"</span> <span class="Cbar">|</span> <span class="Cstring">"Cygwin"</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cstring">"Ctrl-D"</span>
<span class="Clinenum">  54:</span><span class="Cbackground"> </span>                  <span class="Cbar">|</span> <span class="Cstring">"Win32"</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cstring">"Ctrl-Z"</span>
<span class="Clinenum">  55:</span><span class="Cbackground"> </span>                  <span class="Cbar">|</span> <span class="Cnonalphakeyword">_</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cstring">"EOF"</span><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  56:</span><span class="Cbackground"> </span>  print_endline <span class="Cstring">" to exit."</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  57:</span><span class="Cbackground"> </span>  print_endline <span class="Cstring">"Input syntax: "</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  58:</span><span class="Cbackground"> </span>  print_endline <span class="Cstring">"   ?- query.           Make a query."</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  59:</span><span class="Cbackground"> </span>  print_endline <span class="Cstring">"   a(t1, ..., tn).     Assert an atomic proposition."</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  60:</span><span class="Cbackground"> </span>  print_endline <span class="Cstring">"   A :- B1, ..., Bn.   Assert an inference rule."</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  61:</span><span class="Cbackground"> </span>  print_endline <span class="Cstring">"   $quit               Exit interpreter."</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  62:</span><span class="Cbackground"> </span>  print_endline <span class="Cstring">"   $use \"filename\"     Execute commands from a file."</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  63:</span><span class="Cbackground"> </span>  <span class="Ctry">try</span>
<span class="Clinenum">  64:</span><span class="Cbackground"> </span>    <span class="Cwhile">while</span> <span class="Ctrue">true</span> <span class="Cdo">do</span>
<span class="Clinenum">  65:</span><span class="Cbackground"> </span>      <span class="Ctry">try</span>
<span class="Clinenum">  66:</span><span class="Cbackground"> </span>        print_string <span class="Cstring">"Prolog&gt; "</span><span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  67:</span><span class="Cbackground"> </span>        <span class="Clet">let</span> str <span class="Cnonalphakeyword">=</span> read_line <span class="Cnonalphakeyword">(</span><span class="Cnonalphakeyword">)</span> <span class="Cin">in</span>
<span class="Clinenum">  68:</span><span class="Cbackground"> </span>        <span class="Clet">let</span> lex <span class="Cnonalphakeyword">=</span> <span class="Cconstructor">Message</span><span class="Cnonalphakeyword">.</span>lexer_from_string str <span class="Cin">in</span>
<span class="Clinenum">  69:</span><span class="Cbackground"> </span>        <span class="Clet">let</span> cmds <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  70:</span><span class="Cbackground"> </span>          <span class="Ctry">try</span>
<span class="Clinenum">  71:</span><span class="Cbackground"> </span>            <span class="Cconstructor">Parser</span><span class="Cnonalphakeyword">.</span>toplevel <span class="Cconstructor">Lexer</span><span class="Cnonalphakeyword">.</span>token lex
<span class="Clinenum">  72:</span><span class="Cbackground"> </span>          <span class="Cwith">with</span>
<span class="Clinenum">  73:</span><span class="Cbackground"> </span>            <span class="Cbar">|</span> <span class="Cconstructor">Failure</span><span class="Cnonalphakeyword">(</span><span class="Cstring">"lexing: empty token"</span><span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  74:</span><span class="Cbackground"> </span>            <span class="Cbar">|</span> <span class="Cconstructor">Parsing</span><span class="Cnonalphakeyword">.</span><span class="Cconstructor">Parse_error</span> <span class="Cnonalphakeyword">-&gt;</span> fatal_error <span class="Cnonalphakeyword">(</span><span class="Cconstructor">Message</span><span class="Cnonalphakeyword">.</span>syntax_error lex<span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  75:</span><span class="Cbackground"> </span>        <span class="Cin">in</span>
<span class="Clinenum">  76:</span><span class="Cbackground"> </span>          exec_cmds cmds
<span class="Clinenum">  77:</span><span class="Cbackground"> </span>      <span class="Cwith">with</span>
<span class="Clinenum">  78:</span><span class="Cbackground"> </span>        <span class="Cbar">|</span> <span class="Cconstructor">Fatal_error</span> msg <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">Message</span><span class="Cnonalphakeyword">.</span>report msg
<span class="Clinenum">  79:</span><span class="Cbackground"> </span>        <span class="Cbar">|</span> <span class="Cconstructor">Sys</span><span class="Cnonalphakeyword">.</span><span class="Cconstructor">Break</span> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">Message</span><span class="Cnonalphakeyword">.</span>report <span class="Cnonalphakeyword">(</span><span class="Cstring">"Interrupted."</span><span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  80:</span><span class="Cbackground"> </span>    <span class="Cdone">done</span> 
<span class="Clinenum">  81:</span><span class="Cbackground"> </span>  <span class="Cwith">with</span> <span class="Cconstructor">End_of_file</span> <span class="Cnonalphakeyword">-&gt;</span> print_endline <span class="Cstring">"\nGood bye."</span>
<span class="Clinenum">  82:</span><span class="Cbackground"> </span>
<span class="Clinenum">  83:</span><span class="Cbackground"> </span><span class="Ccomment">(** The main program. *)</span>
<span class="Clinenum">  84:</span><span class="Cbackground"> </span><span class="Clet">let</span> main <span class="Cnonalphakeyword">=</span>
<span class="Clinenum">  85:</span><span class="Cbackground"> </span>  <span class="Cconstructor">Sys</span><span class="Cnonalphakeyword">.</span>catch_break <span class="Ctrue">true</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  86:</span><span class="Cbackground"> </span>  <span class="Clet">let</span> noninteractive <span class="Cnonalphakeyword">=</span> ref <span class="Cfalse">false</span> <span class="Cin">in</span>
<span class="Clinenum">  87:</span><span class="Cbackground"> </span>  <span class="Clet">let</span> files <span class="Cnonalphakeyword">=</span> ref <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span> <span class="Cin">in</span>
<span class="Clinenum">  88:</span><span class="Cbackground"> </span>    <span class="Cconstructor">Arg</span><span class="Cnonalphakeyword">.</span>parse
<span class="Clinenum">  89:</span><span class="Cbackground"> </span>      <span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">(</span><span class="Cstring">"-n"</span><span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Arg</span><span class="Cnonalphakeyword">.</span><span class="Cconstructor">Set</span> noninteractive<span class="Cnonalphakeyword">,</span> <span class="Cstring">"do not run the interactive shell"</span><span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">]</span>
<span class="Clinenum">  90:</span><span class="Cbackground"> </span>      <span class="Cnonalphakeyword">(</span><span class="Cfun">fun</span> f <span class="Cnonalphakeyword">-&gt;</span> files <span class="Cnonalphakeyword">:=</span> f <span class="Cnonalphakeyword">::</span> !files<span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  91:</span><span class="Cbackground"> </span>      <span class="Cstring">"Usage: miniprolog [-n] [file] ..."</span> <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  92:</span><span class="Cbackground"> </span>    files <span class="Cnonalphakeyword">:=</span> <span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>rev !files <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  93:</span><span class="Cbackground"> </span>    <span class="Ctry">try</span>
<span class="Clinenum">  94:</span><span class="Cbackground"> </span>      <span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>iter exec_file !files <span class="Cnonalphakeyword">;</span>
<span class="Clinenum">  95:</span><span class="Cbackground"> </span>      <span class="Cif">if</span> not !noninteractive <span class="Cthen">then</span> shell <span class="Cnonalphakeyword">(</span><span class="Cnonalphakeyword">)</span>
<span class="Clinenum">  96:</span><span class="Cbackground"> </span>    <span class="Cwith">with</span> <span class="Cconstructor">Fatal_error</span> msg <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">Message</span><span class="Cnonalphakeyword">.</span>report msg
</pre>
</body>
</html>
